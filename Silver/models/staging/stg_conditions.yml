version: 2

models:
  - name: stg_conditions
    description: "HL7 Conditions staging table (SNOMED-CT based)"

    columns:
      - name: start_date
        description: "Condition start date"
        tests:
          - not_null

      - name: patient_id
        description: "Unique identifier for the patient"
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_patients')
                field: patient_id

      - name: encounter_id
        description: "Identifier for the related encounter"
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_encounters')
                field: encounter_id

      - name: system
        description: "Coding system used for the condition (SNOMED-CT)"
        tests:
          - not_null
          - accepted_values:
              arguments:
                values: ['SNOMED-CT']

      - name: code
        description: "Condition code"
        tests:
          - not_null

      - name: description
        description: "Condition description text"
        tests:
          - not_null
