version: 2

models:
  - name: stg_alergies
    description: "Standardized allergy data with UUID and severity validation"

    columns:
      - name: start_date
        description: "The date when the allergy was first recorded"   
        tests:
          - not_null

      - name: patient_id
        description: "Unique identifier for the patient"
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('stg_patients')
                field: patient_id
          
      - name: CODE
        description: "Allergy code from standardized coding system"
        tests:
          - not_null

      - name: system
        description: "Coding system used for the allergy code"
        tests:
          - not_null

      - name: description
        description: "Description of the allergy"
        tests:
          - not_null

      - name: severity1
        description: "Severity level of the allergy"
        tests:
          - accepted_values:
              arguments:
                values: ['MILD','MODERATE','SEVERE']

      - name: severity2
        description: "Secondary severity level of the allergy"
        tests:
          - accepted_values:
              arguments:
                values: ['MILD','MODERATE','SEVERE']

    tests:
      - unique_patient_code
        